

函数运行时的作用域链

关于this的易混点其实来自于*动态的this*和*静态的作用域链*。

函数的[作用域链]属性取决于函数生成(也即函数声明和表达式创建)时的执行环境。因此es中的函数是静态作用域。

要将函数的**执行环境调用栈**、函数执行时的作用域链区分开。前者在函数嵌套时会形成动态的调用栈；但它们执行时的作用域链是静态的，与执行环境的调用栈是独立的。

函数中的this值，可以认为是执行时运行环境的一个属性。这个属性在函数调用时才确定。因此this是动态的。

但对于箭头函数不是这样。箭头函数的this也可以认为是一个词法作用域的变量。因为箭头函数执行时的执行环境对应的环境对象(变量对象)上是没有this属性的，因此会去其作用域链上找。作用域链的上一层是函数生成时就确定的，即箭头函数的作用域链属性与普通函数是一致的。